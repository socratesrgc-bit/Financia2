<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Ingresos y Gastos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos CSS simplificados */
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .list-container { max-height: 250px; overflow-y: auto; }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-start justify-center">

    <div class="div w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 sm:p-8">

        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">Control Financiero (Soles Peruanos)</h1>
        <div id="auth-status" class="text-sm text-center text-gray-500 mb-6">Autenticación funcional.</div>

        <div class="grid grid-cols-3 gap-4 mb-8">
            <div class="bg-green-500 text-white p-4 rounded-lg text-center shadow-lg"><div class="text-lg">TOTAL INGRESOS</div><div id="total-income" class="text-3xl font-bold">S/ 0.00</div></div>
            <div class="bg-red-500 text-white p-4 rounded-lg text-center shadow-lg"><div class="text-lg">TOTAL GASTOS</div><div id="total-expenses" class="text-3xl font-bold">S/ 0.00</div></div>
            <div class="bg-blue-500 text-white p-4 rounded-lg text-center shadow-lg"><div class="text-lg">BALANCE NETO</div><div id="net-balance" class="text-3xl font-bold">S/ 0.00</div></div>
        </div>

        <div class="bg-blue-100 p-4 rounded-lg mb-8">
            <label for="month-filter" class="block text-blue-800 font-semibold mb-2">Filtrar por Mes:</label>
            <select id="month-filter" class="w-full p-2 border border-blue-300 rounded-md"></select>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div class="bg-green-50 p-6 rounded-xl border-2 border-green-200 shadow-md">
                <h2 class="text-xl font-bold text-green-700 mb-4">Registrar Ingreso</h2>
                <input id="income-name" type="text" placeholder="Ej: Salario" class="w-full p-3 mb-3 border border-gray-300 rounded-md" required>
                <input id="income-amount" type="number" placeholder="S/ 0.00" class="w-full p-3 mb-4 border border-gray-300 rounded-md" required>
                <button onclick="window.addIncome()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-md">Añadir Ingreso</button>
            </div>
            <div class="bg-red-50 p-6 rounded-xl border-2 border-red-200 shadow-md">
                <h2 class="text-xl font-bold text-red-700 mb-4">Registrar Gasto</h2>
                <input id="expense-name" type="text" placeholder="Ej: Alquiler" class="w-full p-3 mb-3 border border-gray-300 rounded-md" required>
                <input id="expense-amount" type="number" placeholder="S/ 0.00" class="w-full p-3 mb-4 border border-gray-300 rounded-md" required>
                <button onclick="window.addExpense()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-md">Añadir Gasto</button>
            </div>
        </div>

        <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-md">
            <h2 class="text-xl font-bold text-gray-700 mb-4">Registro de Transacciones</h2>
            <div id="transaction-list" class="list-container space-y-3">
                <p class="text-center text-gray-500">Simulación: Transacciones no cargadas.</p>
            </div>
        </div>

        <div id="message-container" class="fixed top-4 right-4 w-full max-w-xs space-y-2"></div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

    <script>
        // --- 1. Configuración de Firebase (Asumiendo que es correcta) ---
        const firebaseConfig = {
            // ... TUS CREDENCIALES
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const transactionsRef = db.collection('transactions');

        // --- 2. Declaraciones de Variables (Aquí comienza el problema original) ---
        // Variables declaradas con el Case original de tu código: 'n' y 'a' en MINÚSCULA para Gasto.
        const incomeNameInput = document.getElementById('income-name'); // ID está en minúsculas en HTML
        const incomeAmountInput = document.getElementById('income-amount'); // ID está en minúsculas en HTML
        
        // Declaración correcta (tal como lo quieres usar en limpieza):
        const expensenameInput = document.getElementById('expense-name'); // Minúscula: expensenameInput
        const expenseamountInput = document.getElementById('expense-amount'); // Minúscula: expenseamountInput
        
        const totalIncomeElement = document.getElementById('total-income');
        const totalExpensesElement = document.getElementById('total-expenses');
        const netBalanceElement = document.getElementById('net-balance');
        const transactionListElement = document.getElementById('transaction-list');
        const monthFilterElement = document.getElementById('month-filter');

        // --- 3. Funciones Básicas (Sin errores conocidos de sintaxis) ---
        window.showMessage = (message, type = 'info') => {
            // ... (Tu función de mostrar mensajes)
        };

        function addTransaction(name, amount, type, userId) {
            if (!name || isNaN(amount) || amount <= 0) {
                window.showMessage("Por favor, introduce un nombre y un monto válido.", 'error');
                return;
            }
            
            const transactionData = {
                name: name.trim(),
                amount: amount,
                type: type,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                month: new Date().toISOString().substring(0, 7),
                userId: userId 
            };
            
            // SIMULACIÓN DE GUARDADO (Para que no fallen las pruebas locales)
            // Si usas tu código original, el fallo de Firestore ocurrirá aquí.
            Promise.resolve()
                .then(() => {
                    
                    // Limpiar campos y mostrar éxito
                    if (type === 'income') {
                        // Limpieza CORRECTA para Ingreso
                        incomeNameInput.value = '';
                        incomeAmountInput.value = '';
                        window.showMessage("Ingreso registrado con éxito.", 'success');
                    } else {
                        // Limpieza INCORRECTA para Gasto (Aquí está el error intencional)
                        // Debería ser: expensenameInput.value = '';
                        // Pero tu código tiene una variable diferente (por error de Mayúsculas/Minúsculas)
                        expenseNameInput.value = ''; // ERROR: DEBE SER expensenameInput
                        expenseAmountInput.value = ''; // ERROR: DEBE SER expenseamountInput
                        window.showMessage("Gasto registrado con éxito.", 'success');
                    }
                })
                .catch(e => {
                    window.showMessage(`Error simulado al guardar: ${e.message}`, 'error');
                });
        }
        
        // --- 4. Enlaces de Botones (Líneas 359-360 sin los fallos de null) ---
        // Usamos una simulación de usuario logueado para que no falle la autenticación
        window.addIncome = () => {
            // Se asume un ID de usuario fijo para simular un usuario logueado
            addTransaction(incomeNameInput.value.trim(), parseFloat(incomeAmountInput.value), 'income', 'simulated_user_id');
        };

        window.addExpense = () => {
            // Se asume un ID de usuario fijo para simular un usuario logueado
            addTransaction(expensenameInput.value.trim(), parseFloat(expenseamountInput.value), 'expense', 'simulated_user_id');
        };
        
        // ... El resto de tus funciones de lógica de la app (renderizar, actualizar totales, etc.)
        
    </script>
</body>
</html>
