<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Ingresos y Gastos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .list-container {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 transparent;
        }
        .list-container::-webkit-scrollbar {
            width: 6px;
        }
        .list-container::-webkit-scrollbar-track {
            background: transparent;
        }
        .list-container::-webkit-scrollbar-thumb {
            background-color: #cbd5e0;
            border-radius: 3px;
        }
        .gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .gradient-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        .gradient-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        .gradient-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }
        .stat-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
    </style>
    <script type="module">
        // --- AUTODIAGN√ìSTICO CR√çTICO PARA USO LOCAL ---
        if (window.location.protocol === 'file:') {
            window.onload = function() {
                const messageBox = document.getElementById('message-box');
                if (messageBox) {
                    messageBox.innerHTML = `
                        <div class="bg-red-50 border border-red-200 rounded-xl p-6 text-center">
                            <div class="text-red-600 text-4xl mb-3">‚ö†Ô∏è</div>
                            <h3 class="text-red-800 font-bold text-lg mb-2">Error de Configuraci√≥n</h3>
                            <p class="text-red-600 text-sm">
                                Esta aplicaci√≥n requiere un servidor web para funcionar correctamente.
                                No puede ejecutarse localmente abriendo el archivo directamente.
                            </p>
                            <p class="text-red-500 text-xs mt-2">
                                Usa un servidor local como Live Server o despliega la aplicaci√≥n en un hosting.
                            </p>
                        </div>
                    `;
                    messageBox.classList.remove('hidden');
                }
            };
            return;
        }

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, onSnapshot, collection, query, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCil5A3PMp9-vUY5qTK_wbTmLtStqAEs9E",
            authDomain: "financia2-4f80e.firebaseapp.com",
            projectId: "financia2-4f80e",
            storageBucket: "financia2-4f80e.firebasestorage.app",
            messagingSenderId: "1076125827715",
            appId: "1:1076125827715:web:6cdb2eb77a937be4fe11b6"
        };

        const appId = firebaseConfig.projectId;
        const dbApp = initializeApp(firebaseConfig);
        const db = getFirestore(dbApp);
        const auth = getAuth(dbApp);

        // Variables globales
        window.userId = null;
        window.db = db;
        const EXPENSE_COLLECTION = 'expenses';
        const INCOME_COLLECTION = 'incomes';
        
        window.allIncomes = [];
        window.allExpenses = [];
        window.currentIncomes = [];
        window.currentExpenses = [];

        // Referencias de elementos
        const elements = {
            incomeName: document.getElementById('income-name'),
            incomeAmount: document.getElementById('income-amount'),
            expenseName: document.getElementById('expense-name'),
            expenseAmount: document.getElementById('expense-amount'),
            totalIncome: document.getElementById('total-income'),
            totalExpense: document.getElementById('total-expense'),
            netBalance: document.getElementById('net-balance'),
            incomeList: document.getElementById('income-list'),
            expenseList: document.getElementById('expense-list'),
            userIdDisplay: document.getElementById('user-id-display'),
            messageBox: document.getElementById('message-box'),
            monthFilter: document.getElementById('month-filter'),
            analyzeButton: document.getElementById('analyze-button'),
            analysisResult: document.getElementById('analysis-result')
        };

        // Utilidades
        window.showMessage = (message, type = 'error') => {
            const icon = type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ùå';
            elements.messageBox.innerHTML = `
                <div class="flex items-center justify-between p-4 rounded-lg ${
                    type === 'success' ? 'bg-green-50 text-green-800 border border-green-200' :
                    type === 'warning' ? 'bg-yellow-50 text-yellow-800 border border-yellow-200' :
                    'bg-red-50 text-red-800 border border-red-200'
                }">
                    <div class="flex items-center">
                        <span class="text-lg mr-3">${icon}</span>
                        <span class="font-medium">${message}</span>
                    </div>
                    <button onclick="document.getElementById('message-box').classList.add('hidden')" 
                            class="text-gray-400 hover:text-gray-600">
                        ‚úï
                    </button>
                </div>
            `;
            elements.messageBox.classList.remove('hidden');
            setTimeout(() => {
                elements.messageBox.classList.add('hidden');
            }, 5000);
        };

        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('es-PE', {
                style: 'currency',
                currency: 'PEN'
            }).format(amount);
        };

        // L√≥gica principal
        window.handleDataChange = () => {
            const selectedValue = elements.monthFilter.value;
            let totalIncome = 0;
            let totalExpenses = 0;

            window.currentIncomes = [];
            window.currentExpenses = [];

            const processList = (data, listElement, type) => {
                listElement.innerHTML = '';
                let listTotal = 0;

                if (data.length === 0) {
                    listElement.innerHTML = `
                        <div class="text-center py-8 text-gray-400">
                            <div class="text-4xl mb-2">${type === 'income' ? 'üí∞' : 'üí∏'}</div>
                            <p class="text-sm">No hay ${type === 'income' ? 'ingresos' : 'gastos'} registrados</p>
                        </div>
                    `;
                    return 0;
                }

                const filtered = data.filter(t => {
                    if (selectedValue === 'all') return true;
                    const month = t.dateObj.getMonth() + 1;
                    const year = t.dateObj.getFullYear();
                    return `${String(month).padStart(2, '0')}-${year}` === selectedValue;
                });

                if (filtered.length === 0) {
                    listElement.innerHTML = `
                        <div class="text-center py-8 text-gray-400">
                            <div class="text-3xl mb-2">üìÖ</div>
                            <p class="text-sm">No hay ${type === 'income' ? 'ingresos' : 'gastos'} este mes</p>
                        </div>
                    `;
                    return 0;
                }

                filtered.forEach(item => {
                    listTotal += item.amount;
                    if (type === 'income') window.currentIncomes.push(item);
                    if (type === 'expense') window.currentExpenses.push(item);

                    const li = document.createElement('li');
                    const bgColor = type === 'income' ? 'bg-green-50' : 'bg-red-50';
                    const textColor = type === 'income' ? 'text-green-600' : 'text-red-600';
                    const borderColor = type === 'income' ? 'border-green-200' : 'border-red-200';
                    
                    li.className = `flex justify-between items-center p-4 ${bgColor} border ${borderColor} rounded-lg mb-3 transition-all duration-200 hover:scale-[1.02]`;
                    li.innerHTML = `
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <span class="font-semibold text-gray-800">${item.name}</span>
                                <span class="text-lg font-bold ${textColor}">
                                    ${formatCurrency(item.amount)}
                                </span>
                            </div>
                            <div class="flex items-center justify-between mt-2">
                                <span class="text-xs text-gray-500">${item.dateObj.toLocaleDateString('es-PE')}</span>
                                <button onclick="window.deleteTransaction('${item.id}', '${type}')" 
                                        class="text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 rounded"
                                        title="Eliminar">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                    listElement.appendChild(li);
                });
                return listTotal;
            };

            totalIncome = processList(window.allIncomes, elements.incomeList, 'income');
            totalExpenses = processList(window.allExpenses, elements.expenseList, 'expense');

            elements.totalIncome.textContent = formatCurrency(totalIncome);
            elements.totalExpense.textContent = formatCurrency(totalExpenses);
            elements.netBalance.textContent = formatCurrency(totalIncome - totalExpenses);

            // Actualizar estilo del balance neto
            const balance = totalIncome - totalExpenses;
            elements.netBalance.className = 'text-3xl font-black';
            if (balance > 0) {
                elements.netBalance.classList.add('text-green-600');
            } else if (balance < 0) {
                elements.netBalance.classList.add('text-red-600');
            } else {
                elements.netBalance.classList.add('text-gray-600');
            }
        };

        window.applyFilterAndRecalculate = window.handleDataChange;

        const populateMonthFilter = () => {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", 
                              "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

            let optionsHTML = `<option value="all">üìÖ Todos los meses</option>`;

            for (let i = 0; i < 12; i++) {
                let date = new Date(currentYear, currentMonth - i, 1);
                const month = date.getMonth();
                const year = date.getFullYear();
                const value = `${String(month + 1).padStart(2, '0')}-${year}`;
                const label = `${monthNames[month]} ${year}`;
                const emoji = i === 0 ? 'üéØ' : i < 3 ? 'üìä' : 'üìÖ';
                
                optionsHTML += `<option value="${value}" ${i === 0 ? 'selected' : ''}>${emoji} ${label}</option>`;
            }
            
            elements.monthFilter.innerHTML = optionsHTML;
        };

        // Firebase functions
        const getCollectionRef = (collectionName) => {
            if (!window.userId || !appId) return null;
            return collection(window.db, `artifacts/${appId}/users/${window.userId}/${collectionName}`);
        };

        window.loadFinancialData = () => {
            const expensesRef = getCollectionRef(EXPENSE_COLLECTION);
            const incomesRef = getCollectionRef(INCOME_COLLECTION);

            if (expensesRef) {
                onSnapshot(query(expensesRef), (snapshot) => {
                    window.allExpenses = snapshot.docs.map(doc => ({ 
                        ...doc.data(), 
                        id: doc.id,
                        dateObj: doc.data().timestamp?.toDate() || new Date()
                    }));
                    window.handleDataChange();
                });
            }

            if (incomesRef) {
                onSnapshot(query(incomesRef), (snapshot) => {
                    window.allIncomes = snapshot.docs.map(doc => ({ 
                        ...doc.data(), 
                        id: doc.id,
                        dateObj: doc.data().timestamp?.toDate() || new Date()
                    }));
                    window.handleDataChange();
                });
            }
        };

        // Autenticaci√≥n
        onAuthStateChanged(auth, async (user) => {
            try {
                if (!user) {
                    await signInAnonymously(auth);
                    user = auth.currentUser;
                }
                window.userId = user.uid;
                elements.userIdDisplay.textContent = `üë§ Sesi√≥n: ${window.userId.substring(0, 8)}...`;
                elements.userIdDisplay.title = window.userId;

                populateMonthFilter();
                window.loadFinancialData();
                window.showMessage('Sesi√≥n iniciada correctamente', 'success');
            } catch (e) {
                console.error("Error de autenticaci√≥n:", e);
                window.showMessage("Error al conectar con la base de datos");
            }
        });

        // Funciones CRUD
        const addTransaction = async (name, amount, type) => {
            if (!name || isNaN(amount) || amount <= 0) {
                window.showMessage("Por favor, ingresa un nombre y cantidad v√°lida (mayor a 0)");
                return;
            }

            if (!window.userId) {
                window.showMessage("Error: Usuario no autenticado");
                return;
            }

            const collectionName = type === 'income' ? INCOME_COLLECTION : EXPENSE_COLLECTION;

            try {
                await addDoc(getCollectionRef(collectionName), {
                    name: name.trim(),
                    amount: parseFloat(amount),
                    timestamp: serverTimestamp()
                });

                if (type === 'income') {
                    elements.incomeName.value = '';
                    elements.incomeAmount.value = '';
                } else {
                    elements.expenseName.value = '';
                    elements.expenseAmount.value = '';
                }

                window.showMessage(`${type === 'income' ? 'Ingreso' : 'Gasto'} registrado exitosamente`, 'success');
            } catch (e) {
                console.error(`Error al a√±adir ${type}:`, e);
                window.showMessage(`Error al guardar el ${type === 'income' ? 'ingreso' : 'gasto'}`);
            }
        };

        window.addIncome = () => addTransaction(
            elements.incomeName.value, 
            parseFloat(elements.incomeAmount.value), 
            'income'
        );

        window.addExpense = () => addTransaction(
            elements.expenseName.value, 
            parseFloat(elements.expenseAmount.value), 
            'expense'
        );

        window.deleteTransaction = async (docId, type) => {
            if (!window.userId) {
                window.showMessage("Error: Usuario no autenticado");
                return;
            }

            const collectionName = type === 'income' ? INCOME_COLLECTION : EXPENSE_COLLECTION;
            
            try {
                const docRef = doc(window.db, `artifacts/${appId}/users/${window.userId}/${collectionName}`, docId);
                await deleteDoc(docRef);
                window.showMessage(`${type === 'income' ? 'Ingreso' : 'Gasto'} eliminado`, 'success');
            } catch (e) {
                console.error("Error al eliminar:", e);
                window.showMessage("Error al eliminar la transacci√≥n");
            }
        };

        // Funciones adicionales (placeholder)
        window.analyzeFinancesWithGemini = async () => {
            elements.analyzeButton.disabled = true;
            elements.analyzeButton.innerHTML = 'üîÑ Analizando...';
            elements.analysisResult.innerHTML = `
                <div class="text-center py-8">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"></div>
                    <p class="text-gray-500">Generando an√°lisis con IA...</p>
                </div>
            `;

            // Simulaci√≥n de an√°lisis (reemplazar con tu l√≥gica real)
            setTimeout(() => {
                elements.analyzeButton.disabled = false;
                elements.analyzeButton.innerHTML = 'ü§ñ Generar An√°lisis con IA';
                elements.analysisResult.innerHTML = `
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                        <h4 class="font-semibold text-blue-800 mb-3">üìà An√°lisis Financiero</h4>
                        <p class="text-blue-700 text-sm mb-3">
                            Basado en tus transacciones del mes actual, tienes un balance 
                            <strong class="${parseFloat(elements.netBalance.textContent.replace(/[^\d.-]/g, '')) >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${elements.netBalance.textContent}
                            </strong>.
                        </p>
                        <p class="text-blue-700 text-sm">
                            üí° <strong>Consejo:</strong> Considera revisar tus gastos recurrentes y 
                            establecer un presupuesto mensual para mejorar tu salud financiera.
                        </p>
                    </div>
                `;
            }, 2000);
        };

        window.exportDataToCSV = () => {
            window.showMessage('Funci√≥n de exportaci√≥n en desarrollo', 'warning');
        };

    </script>
</head>
<body class="min-h-screen py-8 px-4">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="glass-card rounded-2xl p-8 mb-8 text-center">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">
                üí∞ Control Financiero Personal
            </h1>
            <p class="text-gray-600 mb-4">Gestiona tus ingresos y gastos en Soles Peruanos</p>
            <div class="flex items-center justify-center space-x-4 text-sm text-gray-500">
                <span id="user-id-display" class="bg-gray-100 px-3 py-1 rounded-full">
                    üîÑ Conectando...
                </span>
                <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full">
                    üí≥ Soles (PEN)
                </span>
            </div>
        </div>

        <!-- Message Box -->
        <div id="message-box" class="hidden mb-6"></div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border border-green-200">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Total Ingresos</h3>
                    <span class="text-2xl">üì•</span>
                </div>
                <div class="text-3xl font-bold text-green-600 mb-2" id="total-income">S/ 0.00</div>
                <div class="text-xs text-gray-500">Ingresos del periodo seleccionado</div>
            </div>

            <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border border-red-200">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Total Gastos</h3>
                    <span class="text-2xl">üì§</span>
                </div>
                <div class="text-3xl font-bold text-red-600 mb-2" id="total-expense">S/ 0.00</div>
                <div class="text-xs text-gray-500">Gastos del periodo seleccionado</div>
            </div>

            <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border border-indigo-200">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Balance Neto</h3>
                    <span class="text-2xl">‚öñÔ∏è</span>
                </div>
                <div class="text-3xl font-bold text-gray-600 mb-2" id="net-balance">S/ 0.00</div>
                <div class="text-xs text-gray-500">Resultado financiero neto</div>
            </div>
        </div>

        <!-- Filtro -->
        <div class="glass-card rounded-2xl p-6 mb-8">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-1">üìä Filtro de Periodo</h3>
                    <p class="text-sm text-gray-600">Selecciona el mes que deseas visualizar</p>
                </div>
                <select id="month-filter" onchange="window.applyFilterAndRecalculate()"
                        class="bg-white border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 min-w-[200px]">
                    <option value="all">Cargando meses...</option>
                </select>
            </div>
        </div>

        <!-- Formularios -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Ingresos -->
            <div class="glass-card rounded-2xl p-6 border border-green-200">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                        <span class="text-xl">üíπ</span>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800">Agregar Ingreso</h3>
                        <p class="text-sm text-gray-600">Registra nuevos ingresos</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n</label>
                        <input type="text" id="income-name" placeholder="Ej: Salario, Ventas, Bonificaci√≥n"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Monto (S/)</label>
                        <input type="number" id="income-amount" placeholder="0.00" step="0.01" min="0.01"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    </div>
                    <button onclick="window.addIncome()"
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 flex items-center justify-center">
                        <span class="mr-2">‚ûï</span> Agregar Ingreso
                    </button>
                </div>
            </div>

            <!-- Gastos -->
            <div class="glass-card rounded-2xl p-6 border border-red-200">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                        <span class="text-xl">üìâ</span>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800">Agregar Gasto</h3>
                        <p class="text-sm text-gray-600">Registra nuevos gastos</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n</label>
                        <input type="text" id="expense-name" placeholder="Ej: Alquiler, Comida, Transporte"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Monto (S/)</label>
                        <input type="number" id="expense-amount" placeholder="0.00" step="0.01" min="0.01"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500">
                    </div>
                    <button onclick="window.addExpense()"
                            class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 flex items-center justify-center">
                        <span class="mr-2">‚ûñ</span> Agregar Gasto
                    </button>
                </div>
            </div>
        </div>

        <!-- Herramientas Adicionales -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- An√°lisis IA -->
            <div class="glass-card rounded-2xl p-6 border border-indigo-200">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-3">
                        <span class="text-xl">ü§ñ</span>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800">An√°lisis con IA</h3>
                        <p class="text-sm text-gray-600">Obt√©n insights inteligentes</p>
                    </div>
                </div>
                
                <button id="analyze-button" onclick="window.analyzeFinancesWithGemini()"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 mb-4">
                    ü§ñ Generar An√°lisis con IA
                </button>
                
                <div id="analysis-result" class="bg-gray-50 rounded-xl p-4 min-h-[120px]">
                    <p class="text-gray-500 text-center italic py-4">
                        Haz clic en el bot√≥n para obtener un an√°lisis inteligente de tus finanzas
                    </p>
                </div>
            </div>

            <!-- Exportar -->
            <div class="glass-card rounded-2xl p-6 border border-gray-200">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                        <span class="text-xl">üíæ</span>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800">Exportar Datos</h3>
                        <p class="text-sm text-gray-600">Guarda tu informaci√≥n</p>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <button onclick="window.exportDataToCSV()"
                            class="w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 flex items-center justify-center">
                        <span class="mr-2">üì•</span> Descargar CSV
                    </button>
                    <p class="text-xs text-gray-500 text-center">
                        Exporta tus transacciones a formato CSV compatible con Excel
                    </p>
                </div>
            </div>
        </div>

        <!-- Historial -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Ingresos -->
            <div class="glass-card rounded-2xl p-6 border border-green-200">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">üì• Historial de Ingresos</h3>
                    <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-medium">
                        ${window.currentIncomes?.length || 0} registros
                    </span>
                </div>
                <ul id="income-list" class="list-container space-y-3">
                    <li class="text-center py-8 text-gray-400">
                        <div class="text-4xl mb-2">üí∞</div>
                        <p>No hay ingresos registrados</p>
                    </li>
                </ul>
            </div>

            <!-- Gastos -->
            <div class="glass-card rounded-2xl p-6 border border-red-200">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">üì§ Historial de Gastos</h3>
                    <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-sm font-medium">
                        ${window.currentExpenses?.length || 0} registros
                    </span>
                </div>
                <ul id="expense-list" class="list-container space-y-3">
                    <li class="text-center py-8 text-gray-400">
                        <div class="text-4xl mb-2">üí∏</div>
                        <p>No hay gastos registrados</p>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
